-- This script was generated by the ERD tool in pgAdmin 4.
-- Please log an issue at https://github.com/pgadmin-org/pgadmin4/issues/new/choose if you find any bugs, including reproduction steps.
BEGIN;


CREATE TABLE IF NOT EXISTS public."mSeen"
(
    m_id integer NOT NULL,
    us_id integer NOT NULL,
    CONSTRAINT "mSeen_pkey" PRIMARY KEY (m_id, us_id)
);

CREATE TABLE IF NOT EXISTS public."mUnlocked"
(
    m_id integer NOT NULL,
    us_id integer NOT NULL,
    CONSTRAINT "mUnlocked_pkey" PRIMARY KEY (m_id, us_id)
);

CREATE TABLE IF NOT EXISTS public.messages
(
    m_id integer NOT NULL DEFAULT nextval('messages_id_seq'::regclass),
    m_type text COLLATE pg_catalog."default",
    creator character varying(100) COLLATE pg_catalog."default",
    unl_rad integer NOT NULL DEFAULT 30,
    geom geometry(Point,4326) NOT NULL,
    crt_time integer,
    uni text COLLATE pg_catalog."default",
    view_once boolean,
    status boolean,
    m_txt text COLLATE pg_catalog."default",
    q_multi boolean,
    CONSTRAINT messages_pkey PRIMARY KEY (m_id)
);

CREATE TABLE IF NOT EXISTS public."possAnsw"
(
    q_id integer NOT NULL,
    aswr_id integer NOT NULL,
    aswr_txt text COLLATE pg_catalog."default" NOT NULL,
    tf boolean NOT NULL,
    CONSTRAINT "possAnsw_pkey" PRIMARY KEY (q_id)
);

CREATE TABLE IF NOT EXISTS public.question
(
    q_id integer NOT NULL,
    q_txt text COLLATE pg_catalog."default",
    CONSTRAINT question_pkey PRIMARY KEY (q_id)
);

CREATE TABLE IF NOT EXISTS public.universe
(
    uni_id integer NOT NULL DEFAULT nextval('"universe_universalID_seq"'::regclass),
    uni_name character varying(150) COLLATE pg_catalog."default" NOT NULL,
    pub_priv boolean NOT NULL,
    descri text COLLATE pg_catalog."default",
    CONSTRAINT universe_pkey PRIMARY KEY (uni_id)
);

CREATE TABLE IF NOT EXISTS public."userAnsw"
(
    q_id integer,
    aswr_id integer,
    us_id integer
);

CREATE TABLE IF NOT EXISTS public."userUniv"
(
    us_id integer NOT NULL,
    uni_id integer,
    CONSTRAINT "USERS/UNI=UsUn_pkey" PRIMARY KEY (us_id)
);

CREATE TABLE IF NOT EXISTS public.users
(
    us_id integer NOT NULL,
    us_name integer NOT NULL DEFAULT nextval('users_user_name_seq'::regclass),
    pwd text COLLATE pg_catalog."default" NOT NULL,
    CONSTRAINT users_pkey PRIMARY KEY (us_id)
);

CREATE TABLE IF NOT EXISTS public.users_universe
(
    users_us_id integer NOT NULL,
    universe_uni_id integer NOT NULL DEFAULT nextval('"universe_universalID_seq"'::regclass)
);

CREATE TABLE IF NOT EXISTS public.users_messages
(
    users_us_id integer NOT NULL,
    messages_m_id integer NOT NULL DEFAULT nextval('messages_id_seq'::regclass)
);

ALTER TABLE IF EXISTS public.messages
    ADD CONSTRAINT creator FOREIGN KEY (creator)
    REFERENCES public.users (us_id) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION
    NOT VALID;


ALTER TABLE IF EXISTS public.messages
    ADD CONSTRAINT uni FOREIGN KEY (uni)
    REFERENCES public.universe (uni_id) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION
    NOT VALID;


ALTER TABLE IF EXISTS public.messages
    ADD CONSTRAINT q_multi FOREIGN KEY (q_multi)
    REFERENCES public.question (q_id) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION
    NOT VALID;


ALTER TABLE IF EXISTS public."possAnsw"
    ADD CONSTRAINT q_id FOREIGN KEY (q_id)
    REFERENCES public."userAnsw" (q_id) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION
    NOT VALID;


ALTER TABLE IF EXISTS public."possAnsw"
    ADD CONSTRAINT aswr_id FOREIGN KEY (aswr_id)
    REFERENCES public."userAnsw" (aswr_id) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION
    NOT VALID;


ALTER TABLE IF EXISTS public.question
    ADD CONSTRAINT q_id FOREIGN KEY (q_id)
    REFERENCES public."possAnsw" (q_id) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION
    NOT VALID;


ALTER TABLE IF EXISTS public.users_universe
    ADD FOREIGN KEY (users_us_id)
    REFERENCES public.users (us_id) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION
    NOT VALID;


ALTER TABLE IF EXISTS public.users_universe
    ADD FOREIGN KEY (universe_uni_id)
    REFERENCES public.universe (uni_id) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION
    NOT VALID;


ALTER TABLE IF EXISTS public.users_messages
    ADD FOREIGN KEY (users_us_id)
    REFERENCES public.users (us_id) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION
    NOT VALID;


ALTER TABLE IF EXISTS public.users_messages
    ADD FOREIGN KEY (messages_m_id)
    REFERENCES public.messages (m_id) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION
    NOT VALID;

END;
